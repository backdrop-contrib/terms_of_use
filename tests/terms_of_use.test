<?php
// $Id$

/**
 * @file
 * Terms of use module functionality tests.
 */

/**
 * Base class for all terms od use web test cases.
 */
class TOUWebTestCase extends DrupalWebTestCase {

  protected $admin_user;
  protected $node;
  protected $lable;
  protected $fieldset;
  protected $body;
  protected $xss;

  public function setUp() {
    // String for XSS Test.
    $this->xss = '<script>alert("XSS Test");</script>';

    $this->lable = $this->randomString() . $this->xss;
    $this->fieldset = $this->randomString() . $this->xss;
    $this->body = $this->randomName();

// Enable the terms of use module.
    parent::setUp('terms_of_use');

    $this->admin_user = $this->drupalCreateUser(array('administer site configuration'));
    $this->drupalLogin($this->admin_user);

    // Default terms of use node.
    $this->node = $this->drupalCreateNode(array('type' => 'page', 'body' => $this->body));
  }
}

/**
 * Test for all simple settings.
 */
class TOUSettingsTestCase extends TOUWebTestCase {

  public static function getInfo() {
    return array(
    'name' => 'TOU Basic',
    'description' => 'Basic settings tests.',
    'group' => 'Terms of use',
    );
  }

  public function testTOUSettings() {
    $edit = array(
      'terms_of_use_node_title' => $this->node->title,
      'terms_of_use_checkbox_label' => $this->lable,
      'terms_of_use_fieldset_name' => $this->fieldset,
    );
    $this->drupalPost('admin/settings/terms_of_use', $edit, t('Save configuration'));
    $this->assertFieldByName('terms_of_use_node_title', $this->node->title, 'Node set.');
    $this->assertFieldByName('terms_of_use_checkbox_label', $this->lable, 'Lable name set.');
    $this->assertFieldByName('terms_of_use_fieldset_name', $this->fieldset, 'Fieldset name set.');

    $this->drupalLogout();
    $this->drupalGet('user/register');
    $this->assertText(check_plain($this->lable), 'Checkbox lable found.');
    $this->assertText(check_plain($this->fieldset), 'Fieldset name found.');
    $this->assertText($this->body, 'Terms node body text found.');


    $this->drupalPost('user/register', array(), t('Create new account'));
    $this->assertText('You must agree with the ' . check_plain($this->fieldset) . ' to get an account.', 'Checkbox lable found.');
    
  }
}
